<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bank Transaction Matching - BookClose</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
    <div class="flex h-screen">
        <!-- Left Pane: Transaction Lanes -->
        <div class="w-1/4 p-4 bg-white border-r">
            <div class="mb-6">
                <a href="index.html" class="text-blue-500 hover:text-blue-700">‚Üê Back to Index</a>
            </div>
            <h2 class="text-lg font-bold mb-4">Transaction Lanes</h2>
            
            <!-- High Dollar Transactions -->
            <div class="mb-6">
                <h3 class="font-semibold text-red-600 mb-2">High $ (>$10,000)</h3>
                <ul id="highDollarList" class="space-y-2">
                    <!-- Populated by JavaScript -->
                </ul>
            </div>
            
            <!-- New Vendor Transactions -->
            <div class="mb-6">
                <h3 class="font-semibold text-blue-600 mb-2">New Vendor</h3>
                <ul id="newVendorList" class="space-y-2">
                    <!-- Populated by JavaScript -->
                </ul>
            </div>
            
            <!-- Unreconciled Transactions -->
            <div class="mb-6">
                <h3 class="font-semibold text-yellow-600 mb-2">Unreconciled</h3>
                <ul id="unreconciledList" class="space-y-2">
                    <!-- Populated by JavaScript -->
                </ul>
            </div>
        </div>

        <!-- Center Pane: Transaction Details -->
        <div class="w-1/2 p-4 bg-white">
            <h2 class="text-lg font-bold mb-4">Transaction Details</h2>
            <div id="transactionDetails" class="space-y-4">
                <p class="text-gray-500">Select a transaction to view details</p>
            </div>
        </div>

        <!-- Right Pane: Actions -->
        <div class="w-1/4 p-4 bg-white border-l">
            <h2 class="text-lg font-bold mb-4">Actions</h2>
            <div id="actionButtons" class="space-y-3">
                <p class="text-gray-500 text-sm">Select a transaction to see actions</p>
            </div>
            
            <!-- Binder Status Widget -->
            <div class="mt-8 p-4 bg-blue-50 rounded-lg">
                <h3 class="font-semibold text-blue-800 mb-2">Binder Status</h3>
                <p class="text-blue-600">Pending: <span id="pendingCount">0</span> transactions</p>
                <p class="text-blue-600 text-sm">Confidence: 0.6-0.89</p>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white p-6 rounded-lg">
            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto mb-2"></div>
            <p>Loading transactions...</p>
        </div>
    </div>

    <!-- Error Modal -->
    <div id="errorModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white p-6 rounded-lg max-w-md">
            <h3 class="font-bold text-red-600 mb-2">Error</h3>
            <p id="errorMessage" class="text-gray-700 mb-4"></p>
            <button onclick="hideError()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                Close
            </button>
        </div>
    </div>

    <script>
        // Mock data for demonstration (replace with actual API calls)
        const mockTransactions = [
            {
                transaction_id: 1,
                description: "Office Supplies - Staples",
                amount: 1250.00,
                vendor_name: "Staples",
                account_id: "6000-Office Supplies",
                confidence: 0.75,
                status: "pending",
                date: "2025-01-15"
            },
            {
                transaction_id: 2,
                description: "New Vendor - Tech Solutions Inc",
                amount: 5000.00,
                vendor_name: "Tech Solutions Inc",
                account_id: "6500-Professional Services",
                confidence: 0.65,
                status: "pending",
                date: "2025-01-14"
            },
            {
                transaction_id: 3,
                description: "High Value Equipment Purchase",
                amount: 15000.00,
                vendor_name: "Equipment Co",
                account_id: "1500-Equipment",
                confidence: 0.82,
                status: "pending",
                date: "2025-01-13"
            },
            {
                transaction_id: 4,
                description: "Monthly Software Subscription",
                amount: 299.00,
                vendor_name: "Software Corp",
                account_id: "6500-Software",
                confidence: 0.78,
                status: "pending",
                date: "2025-01-12"
            }
        ];

        let selectedTransaction = null;

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            populateTransactionLanes();
            updatePendingCount();
        });

        // Populate transaction lanes
        function populateTransactionLanes() {
            const highDollar = mockTransactions.filter(t => t.amount > 10000);
            const newVendor = mockTransactions.filter(t => 
                t.description.toLowerCase().includes('new vendor')
            );
            const unreconciled = mockTransactions.filter(t => t.status === 'pending');

            populateLane('highDollarList', highDollar);
            populateLane('newVendorList', newVendor);
            populateLane('unreconciledList', unreconciled);
        }

        // Populate a specific lane
        function populateLane(laneId, transactions) {
            const lane = document.getElementById(laneId);
            lane.innerHTML = '';

            transactions.forEach(txn => {
                const li = document.createElement('li');
                li.className = 'p-2 cursor-pointer hover:bg-gray-100 rounded border-l-2 border-transparent hover:border-blue-500';
                li.onclick = () => selectTransaction(txn);
                
                li.innerHTML = `
                    <div class="font-medium">${txn.description}</div>
                    <div class="text-sm text-gray-600">$${txn.amount.toLocaleString()}</div>
                    <div class="text-xs text-gray-500">Confidence: ${txn.confidence}</div>
                `;
                
                lane.appendChild(li);
            });
        }

        // Select a transaction
        function selectTransaction(txn) {
            selectedTransaction = txn;
            
            // Update selection styling
            document.querySelectorAll('li').forEach(li => {
                li.classList.remove('border-blue-500', 'bg-blue-50');
            });
            event.target.closest('li').classList.add('border-blue-500', 'bg-blue-50');
            
            // Show transaction details
            showTransactionDetails(txn);
            
            // Show action buttons
            showActionButtons(txn);
        }

        // Show transaction details
        function showTransactionDetails(txn) {
            const details = document.getElementById('transactionDetails');
            details.innerHTML = `
                <div class="space-y-3">
                    <div>
                        <label class="font-medium text-gray-700">Memo:</label>
                        <p class="text-gray-900">${txn.description}</p>
                    </div>
                    <div>
                        <label class="font-medium text-gray-700">Vendor:</label>
                        <p class="text-gray-900">${txn.vendor_name || 'Unknown'}</p>
                    </div>
                    <div>
                        <label class="font-medium text-gray-700">Suggested Account:</label>
                        <p class="text-gray-900">${txn.account_id || 'None'}</p>
                    </div>
                    <div>
                        <label class="font-medium text-gray-700">Confidence:</label>
                        <div class="flex items-center space-x-2">
                            <div class="w-24 bg-gray-200 rounded-full h-2">
                                <div class="bg-blue-500 h-2 rounded-full" style="width: ${txn.confidence * 100}%"></div>
                            </div>
                            <span class="text-sm text-gray-600">${(txn.confidence * 100).toFixed(0)}%</span>
                        </div>
                    </div>
                    <div>
                        <label class="font-medium text-gray-700">Date:</label>
                        <p class="text-gray-900">${txn.date}</p>
                    </div>
                    <div class="mt-4">
                        <label class="font-medium text-gray-700">Document Preview:</label>
                        <a href="document_review.html?txn_id=${txn.transaction_id}" 
                           class="block mt-1 text-blue-500 hover:text-blue-700 underline">
                            View Document
                        </a>
                    </div>
                </div>
            `;
        }

        // Show action buttons
        function showActionButtons(txn) {
            const actions = document.getElementById('actionButtons');
            actions.innerHTML = `
                <button onclick="handleAction('accept', ${txn.transaction_id})" 
                        class="w-full bg-green-500 text-white p-3 rounded hover:bg-green-600 transition-colors">
                    Accept (A)
                </button>
                <button onclick="handleAction('recur', ${txn.transaction_id})" 
                        class="w-full bg-blue-500 text-white p-3 rounded hover:bg-blue-600 transition-colors">
                    Recur (R)
                </button>
                <button onclick="handleAction('exception', ${txn.transaction_id})" 
                        class="w-full bg-red-500 text-white p-3 rounded hover:bg-red-600 transition-colors">
                    Exception (X)
                </button>
            `;
        }

        // Handle actions
        function handleAction(action, transactionId) {
            showLoading();
            
            // Simulate API call
            setTimeout(() => {
                hideLoading();
                
                if (action === 'accept' || action === 'recur') {
                    // Simulate categorization
                    alert(`Transaction ${transactionId} ${action === 'accept' ? 'accepted' : 'marked as recurring'}`);
                    
                    // Remove from list (in real app, this would update the transaction)
                    const txn = mockTransactions.find(t => t.transaction_id === transactionId);
                    if (txn) {
                        txn.status = 'processed';
                        populateTransactionLanes();
                        updatePendingCount();
                        
                        // Clear selection
                        selectedTransaction = null;
                        document.getElementById('transactionDetails').innerHTML = '<p class="text-gray-500">Select a transaction to view details</p>';
                        document.getElementById('actionButtons').innerHTML = '<p class="text-gray-500 text-sm">Select a transaction to see actions</p>';
                    }
                } else if (action === 'exception') {
                    // Redirect to document review
                    window.location.href = `document_review.html?txn_id=${transactionId}`;
                }
            }, 1000);
        }

        // Update pending count
        function updatePendingCount() {
            const pending = mockTransactions.filter(t => t.status === 'pending');
            document.getElementById('pendingCount').textContent = pending.length;
        }

        // Show/hide loading
        function showLoading() {
            document.getElementById('loadingOverlay').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.add('hidden');
        }

        // Show/hide error
        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('errorModal').classList.remove('hidden');
        }

        function hideError() {
            document.getElementById('errorModal').classList.add('hidden');
        }
    </script>
</body>
</html>
